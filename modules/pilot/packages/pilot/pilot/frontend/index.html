<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Psyched Pilot</title>
    <link rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Crect width='16' height='16' fill='%230055ff'/%3E%3Ctext x='8' y='12' font-size='9' text-anchor='middle' fill='%23ffffff'%3E%CE%A8%3C/text%3E%3C/svg%3E" />
    <link rel="stylesheet" href="/styles.css" />
    <script type="module" src="/js/pilot.js"></script>
    <script type="module" src="/app.js"></script>
  </head>

  <body x-data="pilotNav()" x-init="init()" class="lcars-body">
    <aside class="lcars-nav">
      <div class="nav-title">PSYCHED PILOT</div>
      <template x-for="section in sections" :key="section.id">
        <div class="nav-item">
          <button type="button" class="nav-button" :class="{ active: section.id === activeId }" @click="scrollTo(section.id)">
            <span class="nav-index" x-text="padIndex(section.index)"></span>
            <span class="nav-label" x-text="section.label"></span>
          </button>
          <template x-if="section.url">
            <a class="nav-link" :href="section.url" target="_blank" rel="noopener" @click.stop>â†—</a>
          </template>
        </div>
      </template>
    </aside>

    <main class="lcars-main">
      <header class="lcars-hero" id="pilot-config">
        <div>
          <h1>Module Dashboards</h1>
          <p>Explore the curated control panels authored by each module team. Every panel can combine ROS data and controls into the experience that makes the most sense for that system.</p>
          <div class="lcars-hero__actions">
            <a class="lcars-hero__link" href="/config/">Open module configuration console</a>
          </div>
        </div>
      </header>
      <div id="pilot-app" class="app-root"></div>
    </main>

    <script>
      function pilotNav() {
        return {
          sections: [],
          activeId: null,
          init() {
            const updateActive = () => {
              for (const section of this.sections) {
                const node = document.getElementById(section.id);
                if (!node) continue;
                const rect = node.getBoundingClientRect();
                if (rect.top < window.innerHeight * 0.45 && rect.bottom > window.innerHeight * 0.25) {
                  this.activeId = section.id;
                  return;
                }
              }
            };
            this.scrollTo = (id) => {
              const node = document.getElementById(id);
              if (node) {
                node.scrollIntoView({ behavior: 'smooth', block: 'start' });
                this.activeId = id;
              }
            };
            this.padIndex = (value) => String(value + 1).padStart(2, '0');
            window.addEventListener('pilot-sections', (event) => {
              this.sections = event.detail || [];
              if (this.sections.length && !this.activeId) {
                this.activeId = this.sections[0].id;
              }
              updateActive();
            });
            window.addEventListener('scroll', updateActive, { passive: true });
          },
        };
      }
    </script>
  </body>
</html>
</html>
