var cn=Object.defineProperty;var sn=(e,t,n)=>t in e?cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $=(e,t,n)=>sn(e,typeof t!="symbol"?t+"":t,n);function S(){}function Ot(e){return e()}function Ut(){return Object.create(null)}function K(e){e.forEach(Ot)}function Rt(e){return typeof e=="function"}function ot(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ce(e){return Object.keys(e).length===0}function Kt(e){return e??""}var yt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var Lt=class e{constructor(t){$(this,"_listeners","WeakMap"in yt?new WeakMap:void 0);$(this,"_observer");$(this,"options");this.options=t}observe(t,n){return this._listeners.set(t,n),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let n of t)e.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};Lt.entries="WeakMap"in yt?new WeakMap:void 0;var Ae=!1;function he(){Ae=!0}function Ge(){Ae=!1}function s(e,t){e.appendChild(t)}function Y(e,t,n){e.insertBefore(t,n||null)}function N(e){e.parentNode&&e.parentNode.removeChild(e)}function At(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function I(e){return document.createElement(e)}function W(e){return document.createTextNode(e)}function Q(){return W(" ")}function at(){return W("")}function rt(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function x(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _e(e){return Array.from(e.childNodes)}function U(e,t){t=""+t,e.data!==t&&(e.data=t)}function Ht(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}function ye(e){let t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}var gt;function ut(e){gt=e}function St(){if(!gt)throw new Error("Function called outside component initialization");return gt}function pt(e){St().$$.on_mount.push(e)}function xt(e){St().$$.on_destroy.push(e)}function qt(){let e=St();return(t,n,{cancelable:o=!1}={})=>{let i=e.$$.callbacks[t];if(i){let l=Ht(t,n,{cancelable:o});return i.slice().forEach(c=>{c.call(e,l)}),!l.defaultPrevented}return!0}}var bt=[];var Bt=[],Gt=[],xe=[],pn=Promise.resolve(),ee=!1;function Be(){ee||(ee=!0,pn.then(zt))}function Zt(e){Gt.push(e)}var te=new Set,ht=0;function zt(){if(ht!==0)return;let e=gt;do{try{for(;ht<bt.length;){let t=bt[ht];ht++,ut(t),bn(t.$$)}}catch(t){throw bt.length=0,ht=0,t}for(ut(null),bt.length=0,ht=0;Bt.length;)Bt.pop()();for(let t=0;t<Gt.length;t+=1){let n=Gt[t];te.has(n)||(te.add(n),n())}Gt.length=0}while(bt.length);for(;xe.length;)xe.pop()();ee=!1,te.clear(),ut(e)}function bn(e){if(e.fragment!==null){e.update(),K(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Zt)}}function Ze(e){let t=[],n=[];Gt.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Gt=t}var jt=new Set,mt;function et(){mt={r:0,c:[],p:mt}}function nt(){mt.r||K(mt.c),mt=mt.p}function z(e,t){e&&e.i&&(jt.delete(e),e.i(t))}function D(e,t,n,o){if(e&&e.o){if(jt.has(e))return;jt.add(e),mt.c.push(()=>{jt.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function E(e){return e?.length!==void 0?e:Array.from(e)}function Ft(e,t){D(e,1,1,()=>{t.delete(e.key)})}function Wt(e,t,n,o,i,l,c,r,u,a,C,v){let A=e.length,Z=l.length,X=A,V={};for(;X--;)V[e[X].key]=X;let h=[],k=new Map,p=new Map,b=[];for(X=Z;X--;){let y=v(i,l,X),G=n(y),w=c.get(G);w?o&&b.push(()=>w.p(y,t)):(w=a(G,y),w.c()),k.set(G,h[X]=w),G in V&&p.set(G,Math.abs(X-V[G]))}let g=new Set,F=new Set;function L(y){z(y,1),y.m(r,C),c.set(y.key,y),C=y.first,Z--}for(;A&&Z;){let y=h[Z-1],G=e[A-1],w=y.key,H=G.key;y===G?(C=y.first,A--,Z--):k.has(H)?!c.has(w)||g.has(w)?L(y):F.has(H)?A--:p.get(w)>p.get(H)?(F.add(w),L(y)):(g.add(H),A--):(u(G,c),A--)}for(;A--;){let y=e[A];k.has(y.key)||u(y,c)}for(;Z;)L(h[Z-1]);return K(b),h}var mn=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Cn=new Set([...mn]);function Ct(e){e&&e.c()}function dt(e,t,n){let{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),Zt(()=>{let l=e.$$.on_mount.map(Ot).filter(Rt);e.$$.on_destroy?e.$$.on_destroy.push(...l):K(l),e.$$.on_mount=[]}),i.forEach(Zt)}function ft(e,t){let n=e.$$;n.fragment!==null&&(Ze(n.after_update),K(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function hn(e,t){e.$$.dirty[0]===-1&&(bt.push(e),Be(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function it(e,t,n,o,i,l,c=null,r=[-1]){let u=gt;ut(e);let a=e.$$={fragment:null,ctx:[],props:l,update:S,not_equal:i,bound:Ut(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:Ut(),dirty:r,skip_bound:!1,root:t.target||u.$$.root};c&&c(a.root);let C=!1;if(a.ctx=n?n(e,t.props||{},(v,A,...Z)=>{let X=Z.length?Z[0]:A;return a.ctx&&i(a.ctx[v],a.ctx[v]=X)&&(!a.skip_bound&&a.bound[v]&&a.bound[v](X),C&&hn(e,v)),A}):[],a.update(),C=!0,K(a.before_update),a.fragment=o?o(a.ctx):!1,t.target){if(t.hydrate){he();let v=_e(t.target);a.fragment&&a.fragment.l(v),v.forEach(N)}else a.fragment&&a.fragment.c();t.intro&&z(e.$$.fragment),dt(e,t.target,t.anchor),Ge(),zt()}ut(u)}var Gn;typeof HTMLElement=="function"&&(Gn=class extends HTMLElement{constructor(t,n,o){super();$(this,"$$ctor");$(this,"$$s");$(this,"$$c");$(this,"$$cn",!1);$(this,"$$d",{});$(this,"$$r",!1);$(this,"$$p_d",{});$(this,"$$l",{});$(this,"$$l_u",new Map);this.$$ctor=t,this.$$s=n,o&&this.attachShadow({mode:"open"})}addEventListener(t,n,o){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(n),this.$$c){let i=this.$$c.$on(t,n);this.$$l_u.set(n,i)}super.addEventListener(t,n,o)}removeEventListener(t,n,o){if(super.removeEventListener(t,n,o),this.$$c){let i=this.$$l_u.get(n);i&&(i(),this.$$l_u.delete(n))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(l){return()=>{let c;return{c:function(){c=I("slot"),l!=="default"&&x(c,"name",l)},m:function(a,C){Y(a,c,C)},d:function(a){a&&N(c)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let n={},o=ye(this);for(let l of this.$$s)l in o&&(n[l]=[t(l)]);for(let l of this.attributes){let c=this.$$g_p(l.name);c in this.$$d||(this.$$d[c]=ne(c,l.value,this.$$p_d,"toProp"))}for(let l in this.$$p_d)!(l in this.$$d)&&this[l]!==void 0&&(this.$$d[l]=this[l],delete this[l]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:n,$$scope:{ctx:[]}}});let i=()=>{this.$$r=!0;for(let l in this.$$p_d)if(this.$$d[l]=this.$$c.$$.ctx[this.$$c.$$.props[l]],this.$$p_d[l].reflect){let c=ne(l,this.$$d[l],this.$$p_d,"toAttribute");c==null?this.removeAttribute(this.$$p_d[l].attribute||l):this.setAttribute(this.$$p_d[l].attribute||l,c)}this.$$r=!1};this.$$c.$$.after_update.push(i),i();for(let l in this.$$l)for(let c of this.$$l[l]){let r=this.$$c.$on(l,c);this.$$l_u.set(c,r)}this.$$l={}}}attributeChangedCallback(t,n,o){this.$$r||(t=this.$$g_p(t),this.$$d[t]=ne(t,o,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(n=>this.$$p_d[n].attribute===t||!this.$$p_d[n].attribute&&n.toLowerCase()===t)||t}});function ne(e,t,n,o){let i=n[e]?.type;if(t=i==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!n[e])return t;if(o==="toAttribute")switch(i){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(i){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var q=class{constructor(){$(this,"$$");$(this,"$$set")}$destroy(){ft(this,1),this.$destroy=S}$on(t,n){if(!Rt(n))return S;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{let i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(t){this.$$set&&!Ce(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Fe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Fe);function _n(e){let t,n,o,i,l,c,r,u=e[2].toFixed(2)+"",a,C,v,A,Z,X=e[3].toFixed(2)+"",V,h,k,p;return{c(){t=I("div"),n=I("div"),o=I("div"),i=Q(),l=I("div"),c=I("span"),r=W("Linear X: "),a=W(u),C=W(" m/s"),v=Q(),A=I("span"),Z=W("Angular Z: "),V=W(X),h=W(" rad/s"),x(o,"class","joystick-knob"),x(n,"class","joystick-grid"),x(l,"class","joystick-readout"),x(t,"class","joystick")},m(b,g){Y(b,t,g),s(t,n),s(n,o),e[6](o),s(t,i),s(t,l),s(l,c),s(c,r),s(c,a),s(c,C),s(l,v),s(l,A),s(A,Z),s(A,V),s(A,h),e[7](t),k||(p=rt(t,"pointerdown",e[4]),k=!0)},p(b,[g]){g&4&&u!==(u=b[2].toFixed(2)+"")&&U(a,u),g&8&&X!==(X=b[3].toFixed(2)+"")&&U(V,X)},i:S,o:S,d(b){b&&N(t),e[6](null),e[7](null),k=!1,p()}}}var yn=.7,xn=2,We=.06,Bn=60;function ve(e,t,n){return Math.min(Math.max(e,t),n)}function Zn(e,t,n){let{record:o}=t,i,l,c=!1,r=0,u=0,a=0;function C(p,b){let g=Date.now();g-r<Bn||(r=g,n(2,u=p),n(3,a=b),o.send({linear:{x:p,y:0,z:0},angular:{x:0,y:0,z:b}}))}function v(){l&&n(1,l.style.transform="translate(-50%, -50%)",l),n(2,u=0),n(3,a=0),o.send({linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}})}function A(p){p.pointerType==="mouse"&&p.button!==0||(c=!0,i.setPointerCapture(p.pointerId),V(p))}function Z(p){c&&V(p)}function X(p){if(c){c=!1;try{i.releasePointerCapture(p.pointerId)}catch{}v()}}function V(p){if(!i||!l)return;let b=i.getBoundingClientRect(),g=b.left+b.width/2,F=b.top+b.height/2,L=Math.min(b.width,b.height)/2,y=l.offsetWidth/2,G=L-y,w=p.clientX-g,H=p.clientY-F,T=Math.min(Math.hypot(w,H),G),j=Math.atan2(H,w),O=Math.cos(j)*T,m=Math.sin(j)*T;n(1,l.style.transform=`translate(calc(-50% + ${O}px), calc(-50% + ${m}px))`,l);let f=O/G,R=m/G,d=Math.abs(f)<We?0:ve(f,-1,1),B=-(Math.abs(R)<We?0:ve(R,-1,1))*yn,J=-d*xn;C(B,J)}pt(()=>{window.addEventListener("pointerup",X),window.addEventListener("pointermove",Z)}),xt(()=>{window.removeEventListener("pointerup",X),window.removeEventListener("pointermove",Z)});function h(p){Bt[p?"unshift":"push"](()=>{l=p,n(1,l)})}function k(p){Bt[p?"unshift":"push"](()=>{i=p,n(0,i)})}return e.$$set=p=>{"record"in p&&n(5,o=p.record)},[i,l,u,a,A,o,h,k]}var oe=class extends q{constructor(t){super(),it(this,t,Zn,_n,ot,{record:5})}},Xe=oe;function Fn(e){let t,n,o,i,l,c,r,u=e[0].acceleration.x+"",a,C,v,A,Z=e[0].acceleration.y+"",X,V,h,k,p=e[0].acceleration.z+"",b,g,F,L,y,G,w,H,T=e[0].angular.x+"",j,O,m,f,R=e[0].angular.y+"",d,_,B,J,ct=e[0].angular.z+"",It,ue,_t,$t,ae,st,vt,ge,Xt=e[0].orientation.x+"",Et,de,Vt,fe,kt=e[0].orientation.y+"",Tt,Ie,Qt,pe,wt=e[0].orientation.z+"",Mt,be,Nt,me,Yt=e[0].orientation.w+"",Pt;return{c(){t=I("div"),n=I("div"),o=I("h5"),o.textContent="Linear Acceleration (m/s\xB2)",i=Q(),l=I("ul"),c=I("li"),r=W("X: "),a=W(u),C=Q(),v=I("li"),A=W("Y: "),X=W(Z),V=Q(),h=I("li"),k=W("Z: "),b=W(p),g=Q(),F=I("div"),L=I("h5"),L.textContent="Angular Velocity (rad/s)",y=Q(),G=I("ul"),w=I("li"),H=W("X: "),j=W(T),O=Q(),m=I("li"),f=W("Y: "),d=W(R),_=Q(),B=I("li"),J=W("Z: "),It=W(ct),ue=Q(),_t=I("div"),$t=I("h5"),$t.textContent="Orientation (quaternion)",ae=Q(),st=I("ul"),vt=I("li"),ge=W("X: "),Et=W(Xt),de=Q(),Vt=I("li"),fe=W("Y: "),Tt=W(kt),Ie=Q(),Qt=I("li"),pe=W("Z: "),Mt=W(wt),be=Q(),Nt=I("li"),me=W("W: "),Pt=W(Yt),x(t,"class","imu-panel")},m(M,tt){Y(M,t,tt),s(t,n),s(n,o),s(n,i),s(n,l),s(l,c),s(c,r),s(c,a),s(l,C),s(l,v),s(v,A),s(v,X),s(l,V),s(l,h),s(h,k),s(h,b),s(t,g),s(t,F),s(F,L),s(F,y),s(F,G),s(G,w),s(w,H),s(w,j),s(G,O),s(G,m),s(m,f),s(m,d),s(G,_),s(G,B),s(B,J),s(B,It),s(t,ue),s(t,_t),s(_t,$t),s(_t,ae),s(_t,st),s(st,vt),s(vt,ge),s(vt,Et),s(st,de),s(st,Vt),s(Vt,fe),s(Vt,Tt),s(st,Ie),s(st,Qt),s(Qt,pe),s(Qt,Mt),s(st,be),s(st,Nt),s(Nt,me),s(Nt,Pt)},p(M,[tt]){tt&1&&u!==(u=M[0].acceleration.x+"")&&U(a,u),tt&1&&Z!==(Z=M[0].acceleration.y+"")&&U(X,Z),tt&1&&p!==(p=M[0].acceleration.z+"")&&U(b,p),tt&1&&T!==(T=M[0].angular.x+"")&&U(j,T),tt&1&&R!==(R=M[0].angular.y+"")&&U(d,R),tt&1&&ct!==(ct=M[0].angular.z+"")&&U(It,ct),tt&1&&Xt!==(Xt=M[0].orientation.x+"")&&U(Et,Xt),tt&1&&kt!==(kt=M[0].orientation.y+"")&&U(Tt,kt),tt&1&&wt!==(wt=M[0].orientation.z+"")&&U(Mt,wt),tt&1&&Yt!==(Yt=M[0].orientation.w+"")&&U(Pt,Yt)},i:S,o:S,d(M){M&&N(t)}}}function lt(e,t=2){return typeof e=="number"&&Number.isFinite(e)?e.toFixed(t):"--"}function Wn(e,t,n){let o,{data:i}=t,l={acceleration:{x:"--",y:"--",z:"--"},angular:{x:"--",y:"--",z:"--"},orientation:{x:"--",y:"--",z:"--",w:"--"}};function c(r){n(1,i=r?.detail??i)}return pt(()=>{window.addEventListener("pilot-imu",c)}),xt(()=>{window.removeEventListener("pilot-imu",c)}),e.$$set=r=>{"data"in r&&n(1,i=r.data)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=(()=>{if(!i)return l;let r=i.linear_acceleration??i.linear??i.acceleration??{},u=i.angular_velocity??i.angular??{},a=i.orientation??{};return{acceleration:{x:lt(r.x),y:lt(r.y),z:lt(r.z)},angular:{x:lt(u.x),y:lt(u.y),z:lt(u.z)},orientation:{x:lt(a.x),y:lt(a.y),z:lt(a.z),w:lt(a.w)}}})())},[o,i]}var ie=class extends q{constructor(t){super(),it(this,t,Wn,Fn,ot,{data:1})}},Ve=ie;function ke(e){let t;return{c(){t=I("span"),t.textContent="Paused",x(t,"class","paused")},m(n,o){Y(n,t,o)},d(n){n&&N(t)}}}function Qe(e){let t,n=e[0].error+"",o;return{c(){t=I("span"),o=W(n),x(t,"class","error")},m(i,l){Y(i,t,l),s(t,o)},p(i,l){l&1&&n!==(n=i[0].error+"")&&U(o,n)},d(i){i&&N(t)}}}function vn(e){let t;return{c(){t=I("div"),t.textContent="Not subscribed",x(t,"class","inactive")},m(n,o){Y(n,t,o)},p:S,i:S,o:S,d(n){n&&N(t)}}}function Xn(e){let t,n,o,i,l=[Qn,kn,Vn],c=[];function r(u,a){return u[1].presentation==="joystick"?0:u[1].presentation==="imu"?1:2}return t=r(e,-1),n=c[t]=l[t](e),{c(){n.c(),o=at()},m(u,a){c[t].m(u,a),Y(u,o,a),i=!0},p(u,a){let C=t;t=r(u,a),t===C?c[t].p(u,a):(et(),D(c[C],1,1,()=>{c[C]=null}),nt(),n=c[t],n?n.p(u,a):(n=c[t]=l[t](u),n.c()),z(n,1),n.m(o.parentNode,o))},i(u){i||(z(n),i=!0)},o(u){D(n),i=!1},d(u){u&&N(o),c[t].d(u)}}}function Vn(e){let t,n;return{c(){t=I("pre"),n=W(e[2]),x(t,"class","topic-payload")},m(o,i){Y(o,t,i),s(t,n)},p(o,i){i&4&&U(n,o[2])},i:S,o:S,d(o){o&&N(t)}}}function kn(e){let t,n;return t=new Ve({props:{data:e[0].last}}),{c(){Ct(t.$$.fragment)},m(o,i){dt(t,o,i),n=!0},p(o,i){let l={};i&1&&(l.data=o[0].last),t.$set(l)},i(o){n||(z(t.$$.fragment,o),n=!0)},o(o){D(t.$$.fragment,o),n=!1},d(o){ft(t,o)}}}function Qn(e){let t,n;return t=new Xe({props:{record:e[0]}}),{c(){Ct(t.$$.fragment)},m(o,i){dt(t,o,i),n=!0},p(o,i){let l={};i&1&&(l.record=o[0]),t.$set(l)},i(o){n||(z(t.$$.fragment,o),n=!0)},o(o){D(t.$$.fragment,o),n=!1},d(o){ft(t,o)}}}function wn(e){let t,n,o,i,l,c,r,u,a,C,v,A=e[0]?.paused&&ke(e),Z=e[0]?.error&&Qe(e),X=[Xn,vn],V=[];function h(k,p){return k[0]?0:1}return a=h(e,-1),C=V[a]=X[a](e),{c(){t=I("div"),n=I("div"),o=I("span"),i=W(e[3]),c=Q(),A&&A.c(),r=Q(),Z&&Z.c(),u=Q(),C.c(),x(o,"class",l=`state ${e[3]}`),x(n,"class","topic-state"),x(t,"class","topic-widget")},m(k,p){Y(k,t,p),s(t,n),s(n,o),s(o,i),s(n,c),A&&A.m(n,null),s(n,r),Z&&Z.m(n,null),s(t,u),V[a].m(t,null),v=!0},p(k,[p]){(!v||p&8)&&U(i,k[3]),(!v||p&8&&l!==(l=`state ${k[3]}`))&&x(o,"class",l),k[0]?.paused?A||(A=ke(k),A.c(),A.m(n,r)):A&&(A.d(1),A=null),k[0]?.error?Z?Z.p(k,p):(Z=Qe(k),Z.c(),Z.m(n,null)):Z&&(Z.d(1),Z=null);let b=a;a=h(k,p),a===b?V[a].p(k,p):(et(),D(V[b],1,1,()=>{V[b]=null}),nt(),C=V[a],C?C.p(k,p):(C=V[a]=X[a](k),C.c()),z(C,1),C.m(t,null))},i(k){v||(z(C),v=!0)},o(k){D(C),v=!1},d(k){k&&N(t),A&&A.d(),Z&&Z.d(),V[a].d()}}}var we=1200;function P(e,t=2){return typeof e=="number"&&Number.isFinite(e)?e.toFixed(t):"--"}function Nn(e){if(!e)return"Awaiting frame\u2026";let t=e.width??e.info?.width,n=e.height??e.info?.height,o=e.encoding??e.info?.encoding??"unknown",i=e.step??e.info?.step;return`Resolution: ${t} \xD7 ${n}
Encoding: ${o}
Step: ${i??"--"}`}function Yn(e){if(!e)return"Awaiting occupancy grid\u2026";let t=e.info?.width??e.width,n=e.info?.height??e.height,o=e.info?.resolution;return`Size: ${t} \xD7 ${n}
Resolution: ${P(o,3)} m/px`}function Un(e){return e?`Waypoints: ${(e.poses??[]).length}`:"Awaiting path\u2026"}function Rn(e){if(!e)return"Awaiting pose\u2026";let t=e.pose?.pose?.position??e.pose?.position??e.position??{},n=e.pose?.pose?.orientation??e.pose?.orientation??e.orientation??{};return`Position: (${P(t.x)}, ${P(t.y)}, ${P(t.z)})
Orientation: (${P(n.x)}, ${P(n.y)}, ${P(n.z)}, ${P(n.w)})`}function Ln(e){if(!e)return"Awaiting twist\u2026";let t=e.twist?.twist?.linear??e.twist?.linear??e.linear??{},n=e.twist?.twist?.angular??e.twist?.angular??e.angular??{};return`Linear: (${P(t.x)}, ${P(t.y)}, ${P(t.z)})
Angular: (${P(n.x)}, ${P(n.y)}, ${P(n.z)})`}function Hn(e){return e==null?"Awaiting message\u2026":typeof e=="string"?e:typeof e.data=="string"?e.data:JSON.stringify(e,null,2)}function Sn(e){if(e==null)return"Awaiting data\u2026";let t=typeof e=="string"?e:JSON.stringify(e,null,2);return t.length>we?`${t.slice(0,we)}\u2026`:t}function zn(e,t,n){let o,i,{record:l}=t,{topic:c}=t;return e.$$set=r=>{"record"in r&&n(0,l=r.record),"topic"in r&&n(1,c=r.topic)},e.$$.update=()=>{e.$$.dirty&1&&n(3,o=l?l.state:"idle"),e.$$.dirty&3&&n(2,i=(()=>{if(!l)return null;let r=c.presentation||"";return r==="image"||r==="depth"?Nn(l.last):r==="map"?Yn(l.last):r==="path"?Un(l.last):r==="pose"?Rn(l.last):r==="vector"?Ln(l.last):r==="status"||r==="text"||r==="log"?Hn(l.last):Sn(l.last)})())},[l,c,i,o]}var le=class extends q{constructor(t){super(),it(this,t,zn,wn,ot,{record:0,topic:1})}},Ne=le;function Ye(e,t,n){let o=e.slice();return o[17]=t[n],o}function Ue(e,t,n){let o=e.slice();return o[20]=t[n],o}function Re(e,t,n){let o=e.slice();return o[20]=t[n],o}function Le(e,t,n){let o=e.slice();return o[25]=t[n],o}function He(e){let t,n=e[0].description+"",o;return{c(){t=I("p"),o=W(n)},m(i,l){Y(i,t,l),s(t,o)},p(i,l){l&1&&n!==(n=i[0].description+"")&&U(o,n)},d(i){i&&N(t)}}}function Se(e){let t,n=E(e[1]),o=[];for(let i=0;i<n.length;i+=1)o[i]=ze(Le(e,n,i));return{c(){t=I("ul");for(let i=0;i<o.length;i+=1)o[i].c();x(t,"class","regime-tags svelte-ihbi64")},m(i,l){Y(i,t,l);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(t,null)},p(i,l){if(l&6){n=E(i[1]);let c;for(c=0;c<n.length;c+=1){let r=Le(i,n,c);o[c]?o[c].p(r,l):(o[c]=ze(r),o[c].c(),o[c].m(t,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=n.length}},d(i){i&&N(t),At(o,i)}}}function ze(e){let t,n=e[2](e[25])+"",o;return{c(){t=I("li"),o=W(n),x(t,"class","svelte-ihbi64")},m(i,l){Y(i,t,l),s(t,o)},p(i,l){l&2&&n!==(n=i[2](i[25])+"")&&U(o,n)},d(i){i&&N(t)}}}function je(e){let t,n=e[20]+"",o,i,l;function c(){return e[10](e[20])}return{c(){t=I("button"),o=W(n),x(t,"type","button")},m(r,u){Y(r,t,u),s(t,o),i||(l=rt(t,"click",c),i=!0)},p(r,u){e=r,u&1&&n!==(n=e[20]+"")&&U(o,n)},d(r){r&&N(t),i=!1,l()}}}function De(e){let t,n=e[20]+"",o,i,l;function c(){return e[11](e[20])}return{c(){t=I("button"),o=W(n),x(t,"type","button")},m(r,u){Y(r,t,u),s(t,o),i||(l=rt(t,"click",c),i=!0)},p(r,u){e=r,u&1&&n!==(n=e[20]+"")&&U(o,n)},d(r){r&&N(t),i=!1,l()}}}function Je(e){let t=e[7](e[17]),n,o,i=$e(e);return{c(){i.c(),n=at()},m(l,c){i.m(l,c),Y(l,n,c),o=!0},p(l,c){c&1&&ot(t,t=l[7](l[17]))?(et(),D(i,1,1,S),nt(),i=$e(l),i.c(),z(i,1),i.m(n.parentNode,n)):i.p(l,c)},i(l){o||(z(i),o=!0)},o(l){D(i),o=!1},d(l){l&&N(n),i.d(l)}}}function jn(e){let t,n,o,i;function l(){return e[14](e[17])}return{c(){t=I("div"),n=I("button"),n.textContent="Connect",x(n,"type","button"),x(t,"class","topic-actions")},m(c,r){Y(c,t,r),s(t,n),o||(i=rt(n,"click",l),o=!0)},p(c,r){e=c},d(c){c&&N(t),o=!1,i()}}}function Dn(e){let t,n,o,i,l=e[8](e[17]).paused?"Resume":"Pause",c,r,u;function a(){return e[12](e[17])}function C(){return e[13](e[17])}return{c(){t=I("div"),n=I("button"),n.textContent="Disconnect",o=Q(),i=I("button"),c=W(l),x(n,"type","button"),x(i,"type","button"),x(t,"class","topic-actions")},m(v,A){Y(v,t,A),s(t,n),s(t,o),s(t,i),s(i,c),r||(u=[rt(n,"click",a),rt(i,"click",C)],r=!0)},p(v,A){e=v,A&1&&l!==(l=e[8](e[17]).paused?"Resume":"Pause")&&U(c,l)},d(v){v&&N(t),r=!1,K(u)}}}function $e(e){let t,n,o,i,l=(e[17].name||e[17].topic)+"",c,r,u,a=e[17].type+"",C,v,A,Z,X,V,h;function k(g,F){return F&1&&(A=null),A==null&&(A=!!g[8](g[17])),A?Dn:jn}let p=k(e,-1),b=p(e);return X=new Ne({props:{record:e[8](e[17]),topic:e[17]}}),{c(){t=I("article"),n=I("div"),o=I("div"),i=I("h4"),c=W(l),r=Q(),u=I("small"),C=W(a),v=Q(),b.c(),Z=Q(),Ct(X.$$.fragment),V=Q(),x(n,"class","topic-header"),x(t,"class","topic-card")},m(g,F){Y(g,t,F),s(t,n),s(n,o),s(o,i),s(i,c),s(o,r),s(o,u),s(u,C),s(n,v),b.m(n,null),s(t,Z),dt(X,t,null),s(t,V),h=!0},p(g,F){(!h||F&1)&&l!==(l=(g[17].name||g[17].topic)+"")&&U(c,l),(!h||F&1)&&a!==(a=g[17].type+"")&&U(C,a),p===(p=k(g,F))&&b?b.p(g,F):(b.d(1),b=p(g),b&&(b.c(),b.m(n,null)));let L={};F&1&&(L.record=g[8](g[17])),F&1&&(L.topic=g[17]),X.$set(L)},i(g){h||(z(X.$$.fragment,g),h=!0)},o(g){D(X.$$.fragment,g),h=!1},d(g){g&&N(t),b.d(),ft(X)}}}function Ee(e,t){let n,o,i,l=t[17]&&Je(t);return{key:e,first:null,c(){n=at(),l&&l.c(),o=at(),this.first=n},m(c,r){Y(c,n,r),l&&l.m(c,r),Y(c,o,r),i=!0},p(c,r){t=c,t[17]?l?(l.p(t,r),r&1&&z(l,1)):(l=Je(t),l.c(),z(l,1),l.m(o.parentNode,o)):l&&(et(),D(l,1,1,()=>{l=null}),nt())},i(c){i||(z(l),i=!0)},o(c){D(l),i=!1},d(c){c&&(N(n),N(o)),l&&l.d(c)}}}function Jn(e){let t,n,o,i=(e[0].display_name||e[0].name)+"",l,c,r,u,a,C,v,A,Z,X,V,h,k,p,b,g,F=[],L=new Map,y,G,w=e[0].description&&He(e),H=e[1].length&&Se(e),T=E(e[0].commands?.mod??[]),j=[];for(let d=0;d<T.length;d+=1)j[d]=je(Re(e,T,d));let O=E(e[0].commands?.system??[]),m=[];for(let d=0;d<O.length;d+=1)m[d]=De(Ue(e,O,d));let f=E(e[0].topics),R=d=>d[17].name||d[17].topic;for(let d=0;d<f.length;d+=1){let _=Ye(e,f,d),B=R(_);L.set(B,F[d]=Ee(B,_))}return{c(){t=I("section"),n=I("header"),o=I("h2"),l=W(i),c=Q(),w&&w.c(),r=Q(),H&&H.c(),u=Q(),a=I("div"),C=I("div"),v=I("h3"),v.textContent="Module Commands",A=Q(),Z=I("div");for(let d=0;d<j.length;d+=1)j[d].c();X=Q(),V=I("div"),h=I("h3"),h.textContent="System Commands",k=Q(),p=I("div");for(let d=0;d<m.length;d+=1)m[d].c();b=Q(),g=I("div");for(let d=0;d<F.length;d+=1)F[d].c();x(Z,"class","button-row"),x(C,"class","command-set"),x(p,"class","button-row"),x(V,"class","command-set"),x(a,"class","command-groups"),x(n,"class","module-header"),x(g,"class","topics-grid"),x(t,"class","module-section"),x(t,"id",y=`module-${e[0].name}`)},m(d,_){Y(d,t,_),s(t,n),s(n,o),s(o,l),s(n,c),w&&w.m(n,null),s(n,r),H&&H.m(n,null),s(n,u),s(n,a),s(a,C),s(C,v),s(C,A),s(C,Z);for(let B=0;B<j.length;B+=1)j[B]&&j[B].m(Z,null);s(a,X),s(a,V),s(V,h),s(V,k),s(V,p);for(let B=0;B<m.length;B+=1)m[B]&&m[B].m(p,null);s(t,b),s(t,g);for(let B=0;B<F.length;B+=1)F[B]&&F[B].m(g,null);G=!0},p(d,[_]){if((!G||_&1)&&i!==(i=(d[0].display_name||d[0].name)+"")&&U(l,i),d[0].description?w?w.p(d,_):(w=He(d),w.c(),w.m(n,r)):w&&(w.d(1),w=null),d[1].length?H?H.p(d,_):(H=Se(d),H.c(),H.m(n,u)):H&&(H.d(1),H=null),_&9){T=E(d[0].commands?.mod??[]);let B;for(B=0;B<T.length;B+=1){let J=Re(d,T,B);j[B]?j[B].p(J,_):(j[B]=je(J),j[B].c(),j[B].m(Z,null))}for(;B<j.length;B+=1)j[B].d(1);j.length=T.length}if(_&9){O=E(d[0].commands?.system??[]);let B;for(B=0;B<O.length;B+=1){let J=Ue(d,O,B);m[B]?m[B].p(J,_):(m[B]=De(J),m[B].c(),m[B].m(p,null))}for(;B<m.length;B+=1)m[B].d(1);m.length=O.length}_&497&&(f=E(d[0].topics),et(),F=Wt(F,_,R,1,d,f,L,g,Ft,Ee,null,Ye),nt()),(!G||_&1&&y!==(y=`module-${d[0].name}`))&&x(t,"id",y)},i(d){if(!G){for(let _=0;_<f.length;_+=1)z(F[_]);G=!0}},o(d){for(let _=0;_<F.length;_+=1)D(F[_]);G=!1},d(d){d&&N(t),w&&w.d(),H&&H.d(),At(j,d),At(m,d);for(let _=0;_<F.length;_+=1)F[_].d()}}}var Dt="general";function $n(e){if(Array.isArray(e)){let n=e.map(o=>`${o}`.trim()).filter(Boolean);return n.length?n:[Dt]}if(typeof e=="string"){let n=e.trim();return n?[n]:[Dt]}if(e==null)return[Dt];let t=`${e}`.trim();return t?[t]:[Dt]}function En(e,t,n){let o,{module:i}=t,{activeTopics:l}=t,c=qt(),r={system:"System",audio:"Audio",conversation:"Conversation",navigation:"Navigation",behavior:"Behavior",perception:"Perception",mobility:"Mobility",general:"General"};function u(g){return g in r?r[g]:g.split(/[-_\s]+/).filter(Boolean).map(F=>F.charAt(0).toUpperCase()+F.slice(1)).join(" ")}function a(g,F){c("runCommand",{scope:g,command:F})}function C(g){c("startTopic",{module:i.name,topic:g})}function v(g){c("stopTopic",{module:i.name,topic:g})}function A(g,F){c("pauseTopic",{module:i.name,topic:g,paused:F})}function Z(g){return`${i.name}:${g.name||g.topic}`}function X(g){return l.get(Z(g))}let V=g=>a("mod",g),h=g=>a("sys",g),k=g=>v(g),p=g=>A(g,!X(g).paused),b=g=>C(g);return e.$$set=g=>{"module"in g&&n(0,i=g.module),"activeTopics"in g&&n(9,l=g.activeTopics)},e.$$.update=()=>{e.$$.dirty&1&&n(1,o=$n(i?.regimes))},[i,o,u,a,C,v,A,Z,X,l,V,h,k,p,b]}var ce=class extends q{constructor(t){super(),it(this,t,En,Jn,ot,{module:0,activeTopics:9})}},Te=ce;var{Map:nn}=yt;function Me(e,t,n){let o=e.slice();return o[27]=t[n],o[29]=n,o}function Pe(e,t,n){let o=e.slice();return o[30]=t[n],o}function Oe(e,t,n){let o=e.slice();return o[33]=t[n],o}function Tn(e){let t,n=[],o=new nn,i,l=E(e[1]),c=r=>r[30].regime;for(let r=0;r<l.length;r+=1){let u=Pe(e,l,r),a=c(u);o.set(a,n[r]=qe(a,u))}return{c(){t=I("div");for(let r=0;r<n.length;r+=1)n[r].c();x(t,"class","pilot-layout svelte-zuyscs")},m(r,u){Y(r,t,u);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(t,null);i=!0},p(r,u){u[0]&1954&&(l=E(r[1]),et(),n=Wt(n,u,c,1,r,l,o,t,Ft,qe,null,Pe),nt())},i(r){if(!i){for(let u=0;u<l.length;u+=1)z(n[u]);i=!0}},o(r){for(let u=0;u<n.length;u+=1)D(n[u]);i=!1},d(r){r&&N(t);for(let u=0;u<n.length;u+=1)n[u].d()}}}function Mn(e){let t,n;return{c(){t=I("div"),n=W(e[3]),x(t,"class","error")},m(o,i){Y(o,t,i),s(t,n)},p(o,i){i[0]&8&&U(n,o[3])},i:S,o:S,d(o){o&&N(t)}}}function Pn(e){let t;return{c(){t=I("div"),t.textContent="Loading pilot modules\u2026",x(t,"class","loading")},m(n,o){Y(n,t,o)},p:S,i:S,o:S,d(n){n&&N(t)}}}function Ke(e,t){let n,o,i;function l(...c){return t[11](t[33],...c)}return o=new Te({props:{id:`module-${t[33].name}`,module:t[33],activeTopics:t[5]}}),o.$on("runCommand",l),o.$on("startTopic",t[8]),o.$on("stopTopic",t[9]),o.$on("pauseTopic",t[10]),{key:e,first:null,c(){n=at(),Ct(o.$$.fragment),this.first=n},m(c,r){Y(c,n,r),dt(o,c,r),i=!0},p(c,r){t=c;let u={};r[0]&2&&(u.id=`module-${t[33].name}`),r[0]&2&&(u.module=t[33]),r[0]&32&&(u.activeTopics=t[5]),o.$set(u)},i(c){i||(z(o.$$.fragment,c),i=!0)},o(c){D(o.$$.fragment,c),i=!1},d(c){c&&N(n),ft(o,c)}}}function qe(e,t){let n,o,i,l=t[30].label+"",c,r,u,a=t[30].modules.length+"",C,v,A=t[30].modules.length===1?"module":"modules",Z,X,V,h=[],k=new nn,p,b,g,F=E(t[30].modules),L=y=>y[33].name;for(let y=0;y<F.length;y+=1){let G=Oe(t,F,y),w=L(G);k.set(w,h[y]=Ke(w,G))}return{key:e,first:null,c(){n=I("section"),o=I("header"),i=I("h1"),c=W(l),r=Q(),u=I("span"),C=W(a),v=Q(),Z=W(A),X=Q(),V=I("div");for(let y=0;y<h.length;y+=1)h[y].c();p=Q(),x(i,"class","svelte-zuyscs"),x(u,"class","module-count svelte-zuyscs"),x(o,"class","regime-header svelte-zuyscs"),x(V,"class","regime-modules svelte-zuyscs"),x(n,"class","regime-group svelte-zuyscs"),x(n,"id",b=`regime-${t[30].regime}`),this.first=n},m(y,G){Y(y,n,G),s(n,o),s(o,i),s(i,c),s(o,r),s(o,u),s(u,C),s(u,v),s(u,Z),s(n,X),s(n,V);for(let w=0;w<h.length;w+=1)h[w]&&h[w].m(V,null);s(n,p),g=!0},p(y,G){t=y,(!g||G[0]&2)&&l!==(l=t[30].label+"")&&U(c,l),(!g||G[0]&2)&&a!==(a=t[30].modules.length+"")&&U(C,a),(!g||G[0]&2)&&A!==(A=t[30].modules.length===1?"module":"modules")&&U(Z,A),G[0]&1954&&(F=E(t[30].modules),et(),h=Wt(h,G,L,1,t,F,k,V,Ft,Ke,null,Oe),nt()),(!g||G[0]&2&&b!==(b=`regime-${t[30].regime}`))&&x(n,"id",b)},i(y){if(!g){for(let G=0;G<F.length;G+=1)z(h[G]);g=!0}},o(y){for(let G=0;G<h.length;G+=1)D(h[G]);g=!1},d(y){y&&N(n);for(let G=0;G<h.length;G+=1)h[G].d()}}}function tn(e){let t,n,o,i,l=E(e[4]),c=[];for(let r=0;r<l.length;r+=1)c[r]=en(Me(e,l,r));return{c(){t=I("section"),n=I("h2"),n.textContent="Command Log",o=Q(),i=I("ul");for(let r=0;r<c.length;r+=1)c[r].c();x(i,"class","svelte-zuyscs"),x(t,"class","command-log svelte-zuyscs"),x(t,"id","command-log")},m(r,u){Y(r,t,u),s(t,n),s(t,o),s(t,i);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(i,null)},p(r,u){if(u[0]&16){l=E(r[4]);let a;for(a=0;a<l.length;a+=1){let C=Me(r,l,a);c[a]?c[a].p(C,u):(c[a]=en(C),c[a].c(),c[a].m(i,null))}for(;a<c.length;a+=1)c[a].d(1);c.length=l.length}},d(r){r&&N(t),At(c,r)}}}function On(e){let t,n=JSON.stringify(e[27].result)+"",o;return{c(){t=I("span"),o=W(n),x(t,"class","detail svelte-zuyscs")},m(i,l){Y(i,t,l),s(t,o)},p(i,l){l[0]&16&&n!==(n=JSON.stringify(i[27].result)+"")&&U(o,n)},d(i){i&&N(t)}}}function Kn(e){let t,n=e[27].error+"",o;return{c(){t=I("span"),o=W(n),x(t,"class","detail svelte-zuyscs")},m(i,l){Y(i,t,l),s(t,o)},p(i,l){l[0]&16&&n!==(n=i[27].error+"")&&U(o,n)},d(i){i&&N(t)}}}function en(e){let t,n,o=e[27].timestamp+"",i,l,c,r=e[27].module+"",u,a,C,v=e[27].scope+"",A,Z,X,V=e[27].command+"",h,k,p,b;function g(y,G){if(y[27].status==="error")return Kn;if(y[27].result)return On}let F=g(e,[-1,-1]),L=F&&F(e);return{c(){t=I("li"),n=I("span"),i=W(o),l=Q(),c=I("span"),u=W(r),a=Q(),C=I("span"),A=W(v),Z=Q(),X=I("span"),h=W(V),k=Q(),L&&L.c(),p=Q(),x(n,"class","timestamp svelte-zuyscs"),x(c,"class","module svelte-zuyscs"),x(C,"class","scope svelte-zuyscs"),x(X,"class","command"),x(t,"class",b=Kt(e[27].status)+" svelte-zuyscs")},m(y,G){Y(y,t,G),s(t,n),s(n,i),s(t,l),s(t,c),s(c,u),s(t,a),s(t,C),s(C,A),s(t,Z),s(t,X),s(X,h),s(t,k),L&&L.m(t,null),s(t,p)},p(y,G){G[0]&16&&o!==(o=y[27].timestamp+"")&&U(i,o),G[0]&16&&r!==(r=y[27].module+"")&&U(u,r),G[0]&16&&v!==(v=y[27].scope+"")&&U(A,v),G[0]&16&&V!==(V=y[27].command+"")&&U(h,V),F===(F=g(y,G))&&L?L.p(y,G):(L&&L.d(1),L=F&&F(y),L&&(L.c(),L.m(t,p))),G[0]&16&&b!==(b=Kt(y[27].status)+" svelte-zuyscs")&&x(t,"class",b)},d(y){y&&N(t),L&&L.d()}}}function qn(e){let t,n,o,i,l,c,r,u,a,C,v,A=e[0].length+"",Z,X,V=[Pn,Mn,Tn],h=[];function k(b,g){return b[2]?0:b[3]?1:2}t=k(e,[-1,-1]),n=h[t]=V[t](e);let p=e[4].length&&tn(e);return{c(){n.c(),o=Q(),p&&p.c(),i=Q(),l=I("footer"),c=I("div"),r=W("Active sockets: "),u=W(e[6]),a=Q(),C=I("div"),v=W("Total modules: "),Z=W(A),x(l,"class","status-bar svelte-zuyscs")},m(b,g){h[t].m(b,g),Y(b,o,g),p&&p.m(b,g),Y(b,i,g),Y(b,l,g),s(l,c),s(c,r),s(c,u),s(l,a),s(l,C),s(C,v),s(C,Z),X=!0},p(b,g){let F=t;t=k(b,g),t===F?h[t].p(b,g):(et(),D(h[F],1,1,()=>{h[F]=null}),nt(),n=h[t],n?n.p(b,g):(n=h[t]=V[t](b),n.c()),z(n,1),n.m(o.parentNode,o)),b[4].length?p?p.p(b,g):(p=tn(b),p.c(),p.m(i.parentNode,i)):p&&(p.d(1),p=null),(!X||g[0]&64)&&U(u,b[6]),(!X||g[0]&1)&&A!==(A=b[0].length+"")&&U(Z,A)},i(b){X||(z(n),X=!0)},o(b){D(n),X=!1},d(b){b&&(N(o),N(i),N(l)),h[t].d(b),p&&p.d(b)}}}var to=40,se="general";function Jt(e,t){return`${e}:${t.name||t.topic||t}`}function eo(e){if(!e||!e.regimes)return[se];let t=e.regimes;if(Array.isArray(t)){let o=t.map(i=>`${i}`.trim()).filter(Boolean);return o.length?o:[se]}let n=`${t}`.trim();return n?[n]:[se]}function no(e){try{e.socket?.close()}catch(t){console.warn("Failed to close socket",t)}}function oo(e,t,n){let o=[],i=[],l=!0,c="",r=[],u=new Map,a=0,C=["system","audio","conversation","navigation","behavior","perception","mobility"],v={system:"System",audio:"Audio",conversation:"Conversation",navigation:"Navigation",behavior:"Behavior",perception:"Perception",mobility:"Mobility",general:"General"};function A(m){return m in v?v[m]:m.split(/[-_\s]+/).filter(Boolean).map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ")}function Z(m){let f=new Map;for(let d of m){let _=eo(d);for(let B of _)f.has(B)||f.set(B,[]),f.get(B).push(d)}return[...C,...Array.from(f.keys()).filter(d=>!C.includes(d)).sort()].filter(d=>f.has(d)).map(d=>({regime:d,label:A(d),modules:f.get(d)}))}function X(){if(typeof window>"u")return;let m=o.map((f,R)=>({id:`module-${f.name}`,label:f.display_name||f.name,index:R}));window.dispatchEvent(new CustomEvent("pilot-sections",{detail:m}))}function V(m){n(4,r=[{...m,timestamp:new Date().toISOString()},...r].slice(0,to))}function h(m,f){let R=new Map(u);R.set(m,f),n(5,u=R)}function k(m){let f=new Map(u);f.delete(m),n(5,u=f)}async function p(){n(2,l=!0),n(3,c="");try{let m=await fetch("/api/modules");if(!m.ok)throw new Error(`Failed to load modules (${m.status})`);let f=await m.json();n(0,o=f.modules??[]),n(1,i=Z(o)),X()}catch(m){n(3,c=m.message??String(m))}finally{n(2,l=!1)}}pt(()=>{p()});async function b(m,f,R){try{V({module:m,scope:f,command:R,status:"running"});let d=await fetch(`/api/modules/${m}/commands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:f,command:R})});if(!d.ok){let B=await d.json().catch(()=>({}));throw new Error(B.detail||`Command failed (${d.status})`)}let _=await d.json();V({module:m,scope:f,command:R,status:"ok",result:_.result})}catch(d){V({module:m,scope:f,command:R,status:"error",error:d.message??String(d)})}}function g(m,f){return u.get(Jt(m,f))}function F(m,f,R){let d=Jt(m,f),_=u.get(d);if(!_)return;let B=R(_)||_;h(d,B)}async function L(m,f){let R=Jt(m,f);if(u.has(R))return;let d={topic:f.topic||f.name,access:f.access||"ro",module:m,qos:f.qos??void 0};try{let _=await fetch("/api/topics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!_.ok){let It=await _.json().catch(()=>({}));throw new Error(It.detail||`Unable to subscribe (${_.status})`)}let J=(await _.json()).session,ct={module:m,topic:f,session:J,state:"connecting",last:null,messages:[],paused:!!J.paused,socket:null,error:null,send(It){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(It))}};h(R,ct),w(R,ct)}catch(_){V({module:m,scope:"topic",command:d.topic,status:"error",error:_.message??String(_)})}}async function y(m,f){let R=Jt(m,f),d=u.get(R);if(d){no(d);try{await fetch(`/api/topics/${d.session.id}`,{method:"DELETE"})}catch(_){console.warn("Failed to drop topic",_)}k(R)}}async function G(m,f,R){let d=g(m,f);if(d)try{let _=await fetch(`/api/topics/${d.session.id}/pause`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paused:R})});if(!_.ok){let J=await _.json().catch(()=>({}));throw new Error(J.detail||`Failed to update pause (${_.status})`)}let B=await _.json();F(m,f,J=>({...J,paused:B.session.paused}))}catch(_){V({module:m,scope:"topic",command:`${f.topic||f.name}:pause`,status:"error",error:_.message??String(_)})}}function w(m,f){let d=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws/topics/${f.session.id}`;try{let _=new WebSocket(d);f.socket=_,n(6,a+=1),f.state="connecting",h(m,f),_.addEventListener("open",()=>{f.state="connected",f.error=null,h(m,f)}),_.addEventListener("close",()=>{f.state="closed",h(m,f),n(6,a=Math.max(0,a-1))}),_.addEventListener("error",()=>{f.error="WebSocket error",h(m,f)}),_.addEventListener("message",B=>{try{let J=JSON.parse(B.data);f.last=J.data??J,f.messages=[f.last,...f.messages].slice(0,50),h(m,f);try{f.topic&&f.topic.presentation==="imu"&&window.dispatchEvent(new CustomEvent("pilot-imu",{detail:f.last}))}catch(ct){console.warn("Failed to dispatch pilot-imu event",ct)}}catch(J){console.warn("Failed to parse topic payload",J)}})}catch(_){f.error=_.message??String(_),f.state="error",h(m,f)}}function H(m){let{module:f,topic:R}=m.detail;L(f,R)}function T(m){let{module:f,topic:R}=m.detail;y(f,R)}function j(m){let{module:f,topic:R,paused:d}=m.detail;G(f,R,d)}return[o,i,l,c,r,u,a,b,H,T,j,(m,{detail:f})=>b(m.name,f.scope,f.command)]}var re=class extends q{constructor(t){super(),it(this,t,oo,qn,ot,{},null,[-1,-1])}},on=re;var ln=document.getElementById("pilot-app");ln&&new on({target:ln});
