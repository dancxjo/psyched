var He=Object.defineProperty;var Ze=(e,t,n)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var X=(e,t,n)=>Ze(e,typeof t!="symbol"?t+"":t,n);function q(){}function Vt(e){return e()}function jt(){return Object.create(null)}function V(e){e.forEach(Vt)}function Dt(e){return typeof e=="function"}function K(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function me(e){return Object.keys(e).length===0}var yt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var Nt=class e{constructor(t){X(this,"_listeners","WeakMap"in yt?new WeakMap:void 0);X(this,"_observer");X(this,"options");this.options=t}observe(t,n){return this._listeners.set(t,n),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let n of t)e.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};Nt.entries="WeakMap"in yt?new WeakMap:void 0;var he=!1;function ge(){he=!0}function ye(){he=!1}function c(e,t){e.appendChild(t)}function R(e,t,n){e.insertBefore(t,n||null)}function N(e){e.parentNode&&e.parentNode.removeChild(e)}function bt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function p(e){return document.createElement(e)}function v(e){return document.createTextNode(e)}function j(){return v(" ")}function lt(){return v("")}function it(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function k(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function be(e){return Array.from(e.childNodes)}function z(e,t){t=""+t,e.data!==t&&(e.data=t)}function Lt(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}function $e(e){let t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}var ct;function st(e){ct=e}function Pt(){if(!ct)throw new Error("Function called outside component initialization");return ct}function $t(e){Pt().$$.on_mount.push(e)}function Ht(e){Pt().$$.on_destroy.push(e)}function Zt(){let e=Pt();return(t,n,{cancelable:o=!1}={})=>{let i=e.$$.callbacks[t];if(i){let r=Lt(t,n,{cancelable:o});return i.slice().forEach(s=>{s.call(e,r)}),!r.defaultPrevented}return!0}}var ft=[];var xt=[],ht=[],xe=[],sn=Promise.resolve(),Qt=!1;function we(){Qt||(Qt=!0,sn.then(Rt))}function wt(e){ht.push(e)}var Kt=new Set,mt=0;function Rt(){if(mt!==0)return;let e=ct;do{try{for(;mt<ft.length;){let t=ft[mt];mt++,st(t),ln(t.$$)}}catch(t){throw ft.length=0,mt=0,t}for(st(null),ft.length=0,mt=0;xt.length;)xt.pop()();for(let t=0;t<ht.length;t+=1){let n=ht[t];Kt.has(n)||(Kt.add(n),n())}ht.length=0}while(ft.length);for(;xe.length;)xe.pop()();Qt=!1,Kt.clear(),st(e)}function ln(e){if(e.fragment!==null){e.update(),V(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(wt)}}function ve(e){let t=[],n=[];ht.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),ht=t}var zt=new Set,pt;function Q(){pt={r:0,c:[],p:pt}}function tt(){pt.r||V(pt.c),pt=pt.p}function B(e,t){e&&e.i&&(zt.delete(e),e.i(t))}function W(e,t,n,o){if(e&&e.o){if(zt.has(e))return;zt.add(e),pt.c.push(()=>{zt.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function Y(e){return e?.length!==void 0?e:Array.from(e)}function It(e,t){W(e,1,1,()=>{t.delete(e.key)})}function qt(e,t,n,o,i,r,s,l,u,a,$,x){let b=e.length,F=r.length,w=b,D={};for(;w--;)D[e[w].key]=w;let M=[],d=new Map,_=new Map,m=[];for(w=F;w--;){let C=x(i,r,w),S=n(C),h=s.get(S);h?o&&m.push(()=>h.p(C,t)):(h=a(S,C),h.c()),d.set(S,M[w]=h),S in D&&_.set(S,Math.abs(w-D[S]))}let g=new Set,L=new Set;function I(C){B(C,1),C.m(l,$),s.set(C.key,C),$=C.first,F--}for(;b&&F;){let C=M[F-1],S=e[b-1],h=C.key,f=S.key;C===S?($=C.first,b--,F--):d.has(f)?!s.has(h)||g.has(h)?I(C):L.has(f)?b--:_.get(h)>_.get(f)?(L.add(h),I(C)):(g.add(f),b--):(u(S,s),b--)}for(;b--;){let C=e[b];d.has(C.key)||u(C,s)}for(;F;)I(M[F-1]);return V(m),M}var cn=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],un=new Set([...cn]);function dt(e){e&&e.c()}function ut(e,t,n){let{fragment:o,after_update:i}=e.$$;o&&o.m(t,n),wt(()=>{let r=e.$$.on_mount.map(Vt).filter(Dt);e.$$.on_destroy?e.$$.on_destroy.push(...r):V(r),e.$$.on_mount=[]}),i.forEach(wt)}function at(e,t){let n=e.$$;n.fragment!==null&&(ve(n.after_update),V(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fn(e,t){e.$$.dirty[0]===-1&&(ft.push(e),we(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function et(e,t,n,o,i,r,s=null,l=[-1]){let u=ct;st(e);let a=e.$$={fragment:null,ctx:[],props:r,update:q,not_equal:i,bound:jt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:jt(),dirty:l,skip_bound:!1,root:t.target||u.$$.root};s&&s(a.root);let $=!1;if(a.ctx=n?n(e,t.props||{},(x,b,...F)=>{let w=F.length?F[0]:b;return a.ctx&&i(a.ctx[x],a.ctx[x]=w)&&(!a.skip_bound&&a.bound[x]&&a.bound[x](w),$&&fn(e,x)),b}):[],a.update(),$=!0,V(a.before_update),a.fragment=o?o(a.ctx):!1,t.target){if(t.hydrate){ge();let x=be(t.target);a.fragment&&a.fragment.l(x),x.forEach(N)}else a.fragment&&a.fragment.c();t.intro&&B(e.$$.fragment),ut(e,t.target,t.anchor),ye(),Rt()}st(u)}var pn;typeof HTMLElement=="function"&&(pn=class extends HTMLElement{constructor(t,n,o){super();X(this,"$$ctor");X(this,"$$s");X(this,"$$c");X(this,"$$cn",!1);X(this,"$$d",{});X(this,"$$r",!1);X(this,"$$p_d",{});X(this,"$$l",{});X(this,"$$l_u",new Map);this.$$ctor=t,this.$$s=n,o&&this.attachShadow({mode:"open"})}addEventListener(t,n,o){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(n),this.$$c){let i=this.$$c.$on(t,n);this.$$l_u.set(n,i)}super.addEventListener(t,n,o)}removeEventListener(t,n,o){if(super.removeEventListener(t,n,o),this.$$c){let i=this.$$l_u.get(n);i&&(i(),this.$$l_u.delete(n))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(r){return()=>{let s;return{c:function(){s=p("slot"),r!=="default"&&k(s,"name",r)},m:function(a,$){R(a,s,$)},d:function(a){a&&N(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let n={},o=$e(this);for(let r of this.$$s)r in o&&(n[r]=[t(r)]);for(let r of this.attributes){let s=this.$$g_p(r.name);s in this.$$d||(this.$$d[s]=te(s,r.value,this.$$p_d,"toProp"))}for(let r in this.$$p_d)!(r in this.$$d)&&this[r]!==void 0&&(this.$$d[r]=this[r],delete this[r]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:n,$$scope:{ctx:[]}}});let i=()=>{this.$$r=!0;for(let r in this.$$p_d)if(this.$$d[r]=this.$$c.$$.ctx[this.$$c.$$.props[r]],this.$$p_d[r].reflect){let s=te(r,this.$$d[r],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[r].attribute||r):this.setAttribute(this.$$p_d[r].attribute||r,s)}this.$$r=!1};this.$$c.$$.after_update.push(i),i();for(let r in this.$$l)for(let s of this.$$l[r]){let l=this.$$c.$on(r,s);this.$$l_u.set(s,l)}this.$$l={}}}attributeChangedCallback(t,n,o){this.$$r||(t=this.$$g_p(t),this.$$d[t]=te(t,o,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(n=>this.$$p_d[n].attribute===t||!this.$$p_d[n].attribute&&n.toLowerCase()===t)||t}});function te(e,t,n,o){let i=n[e]?.type;if(t=i==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!n[e])return t;if(o==="toAttribute")switch(i){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(i){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var H=class{constructor(){X(this,"$$");X(this,"$$set")}$destroy(){at(this,1),this.$destroy=q}$on(t,n){if(!Dt(n))return q;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{let i=o.indexOf(n);i!==-1&&o.splice(i,1)}}$set(t){this.$$set&&!me(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var ke="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ke);function dn(e){let t,n,o,i,r,s,l,u=e[2].toFixed(2)+"",a,$,x,b,F,w=e[3].toFixed(2)+"",D,M,d,_;return{c(){t=p("div"),n=p("div"),o=p("div"),i=j(),r=p("div"),s=p("span"),l=v("Linear X: "),a=v(u),$=v(" m/s"),x=j(),b=p("span"),F=v("Angular Z: "),D=v(w),M=v(" rad/s"),k(o,"class","joystick-knob"),k(n,"class","joystick-grid"),k(r,"class","joystick-readout"),k(t,"class","joystick")},m(m,g){R(m,t,g),c(t,n),c(n,o),e[6](o),c(t,i),c(t,r),c(r,s),c(s,l),c(s,a),c(s,$),c(r,x),c(r,b),c(b,F),c(b,D),c(b,M),e[7](t),d||(_=it(t,"pointerdown",e[4]),d=!0)},p(m,[g]){g&4&&u!==(u=m[2].toFixed(2)+"")&&z(a,u),g&8&&w!==(w=m[3].toFixed(2)+"")&&z(D,w)},i:q,o:q,d(m){m&&N(t),e[6](null),e[7](null),d=!1,_()}}}var _n=.7,mn=2,Fe=.06,hn=60;function Ee(e,t,n){return Math.min(Math.max(e,t),n)}function gn(e,t,n){let{record:o}=t,i,r,s=!1,l=0,u=0,a=0;function $(_,m){let g=Date.now();g-l<hn||(l=g,n(2,u=_),n(3,a=m),o.send({linear:{x:_,y:0,z:0},angular:{x:0,y:0,z:m}}))}function x(){r&&n(1,r.style.transform="translate(-50%, -50%)",r),n(2,u=0),n(3,a=0),o.send({linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}})}function b(_){_.pointerType==="mouse"&&_.button!==0||(s=!0,i.setPointerCapture(_.pointerId),D(_))}function F(_){s&&D(_)}function w(_){if(s){s=!1;try{i.releasePointerCapture(_.pointerId)}catch{}x()}}function D(_){if(!i||!r)return;let m=i.getBoundingClientRect(),g=m.left+m.width/2,L=m.top+m.height/2,I=Math.min(m.width,m.height)/2,C=r.offsetWidth/2,S=I-C,h=_.clientX-g,f=_.clientY-L,A=Math.min(Math.hypot(h,f),S),O=Math.atan2(f,h),T=Math.cos(O)*A,G=Math.sin(O)*A;n(1,r.style.transform=`translate(calc(-50% + ${T}px), calc(-50% + ${G}px))`,r);let y=T/S,P=G/S,E=Math.abs(y)<Fe?0:Ee(y,-1,1),_t=-(Math.abs(P)<Fe?0:Ee(P,-1,1))*_n,vt=-E*mn;$(_t,vt)}$t(()=>{window.addEventListener("pointerup",w),window.addEventListener("pointermove",F)}),Ht(()=>{window.removeEventListener("pointerup",w),window.removeEventListener("pointermove",F)});function M(_){xt[_?"unshift":"push"](()=>{r=_,n(1,r)})}function d(_){xt[_?"unshift":"push"](()=>{i=_,n(0,i)})}return e.$$set=_=>{"record"in _&&n(5,o=_.record)},[i,r,u,a,b,o,M,d]}var ee=class extends H{constructor(t){super(),et(this,t,gn,dn,K,{record:5})}},Se=ee;function yn(e){let t,n,o,i,r,s,l,u=e[0].acceleration.x+"",a,$,x,b,F=e[0].acceleration.y+"",w,D,M,d,_=e[0].acceleration.z+"",m,g,L,I,C,S,h,f,A=e[0].angular.x+"",O,T,G,y,P=e[0].angular.y+"",E,ot,_t,vt,kt=e[0].angular.z+"",Wt,se,gt,Gt,le,rt,Ft,ce,Et=e[0].orientation.x+"",Xt,ue,St,ae,Ct=e[0].orientation.y+"",Jt,fe,Ot,pe,Mt=e[0].orientation.z+"",Yt,de,Tt,_e,At=e[0].orientation.w+"",Ut;return{c(){t=p("div"),n=p("div"),o=p("h5"),o.textContent="Linear Acceleration (m/s\xB2)",i=j(),r=p("ul"),s=p("li"),l=v("X: "),a=v(u),$=j(),x=p("li"),b=v("Y: "),w=v(F),D=j(),M=p("li"),d=v("Z: "),m=v(_),g=j(),L=p("div"),I=p("h5"),I.textContent="Angular Velocity (rad/s)",C=j(),S=p("ul"),h=p("li"),f=v("X: "),O=v(A),T=j(),G=p("li"),y=v("Y: "),E=v(P),ot=j(),_t=p("li"),vt=v("Z: "),Wt=v(kt),se=j(),gt=p("div"),Gt=p("h5"),Gt.textContent="Orientation (quaternion)",le=j(),rt=p("ul"),Ft=p("li"),ce=v("X: "),Xt=v(Et),ue=j(),St=p("li"),ae=v("Y: "),Jt=v(Ct),fe=j(),Ot=p("li"),pe=v("Z: "),Yt=v(Mt),de=j(),Tt=p("li"),_e=v("W: "),Ut=v(At),k(t,"class","imu-panel")},m(J,Z){R(J,t,Z),c(t,n),c(n,o),c(n,i),c(n,r),c(r,s),c(s,l),c(s,a),c(r,$),c(r,x),c(x,b),c(x,w),c(r,D),c(r,M),c(M,d),c(M,m),c(t,g),c(t,L),c(L,I),c(L,C),c(L,S),c(S,h),c(h,f),c(h,O),c(S,T),c(S,G),c(G,y),c(G,E),c(S,ot),c(S,_t),c(_t,vt),c(_t,Wt),c(t,se),c(t,gt),c(gt,Gt),c(gt,le),c(gt,rt),c(rt,Ft),c(Ft,ce),c(Ft,Xt),c(rt,ue),c(rt,St),c(St,ae),c(St,Jt),c(rt,fe),c(rt,Ot),c(Ot,pe),c(Ot,Yt),c(rt,de),c(rt,Tt),c(Tt,_e),c(Tt,Ut)},p(J,[Z]){Z&1&&u!==(u=J[0].acceleration.x+"")&&z(a,u),Z&1&&F!==(F=J[0].acceleration.y+"")&&z(w,F),Z&1&&_!==(_=J[0].acceleration.z+"")&&z(m,_),Z&1&&A!==(A=J[0].angular.x+"")&&z(O,A),Z&1&&P!==(P=J[0].angular.y+"")&&z(E,P),Z&1&&kt!==(kt=J[0].angular.z+"")&&z(Wt,kt),Z&1&&Et!==(Et=J[0].orientation.x+"")&&z(Xt,Et),Z&1&&Ct!==(Ct=J[0].orientation.y+"")&&z(Jt,Ct),Z&1&&Mt!==(Mt=J[0].orientation.z+"")&&z(Yt,Mt),Z&1&&At!==(At=J[0].orientation.w+"")&&z(Ut,At)},i:q,o:q,d(J){J&&N(t)}}}function nt(e,t=2){return typeof e=="number"&&Number.isFinite(e)?e.toFixed(t):"--"}function bn(e,t,n){let o,{data:i}=t,r={acceleration:{x:"--",y:"--",z:"--"},angular:{x:"--",y:"--",z:"--"},orientation:{x:"--",y:"--",z:"--",w:"--"}};return e.$$set=s=>{"data"in s&&n(1,i=s.data)},e.$$.update=()=>{e.$$.dirty&2&&n(0,o=(()=>{if(!i)return r;let s=i.linear_acceleration??i.linear??i.acceleration??{},l=i.angular_velocity??i.angular??{},u=i.orientation??{};return{acceleration:{x:nt(s.x),y:nt(s.y),z:nt(s.z)},angular:{x:nt(l.x),y:nt(l.y),z:nt(l.z)},orientation:{x:nt(u.x),y:nt(u.y),z:nt(u.z),w:nt(u.w)}}})())},[o,i]}var ne=class extends H{constructor(t){super(),et(this,t,bn,yn,K,{data:1})}},Ce=ne;function Oe(e){let t;return{c(){t=p("span"),t.textContent="Paused",k(t,"class","paused")},m(n,o){R(n,t,o)},d(n){n&&N(t)}}}function Me(e){let t,n=e[0].error+"",o;return{c(){t=p("span"),o=v(n),k(t,"class","error")},m(i,r){R(i,t,r),c(t,o)},p(i,r){r&1&&n!==(n=i[0].error+"")&&z(o,n)},d(i){i&&N(t)}}}function $n(e){let t;return{c(){t=p("div"),t.textContent="Not subscribed",k(t,"class","inactive")},m(n,o){R(n,t,o)},p:q,i:q,o:q,d(n){n&&N(t)}}}function xn(e){let t,n,o,i,r=[kn,vn,wn],s=[];function l(u,a){return u[1].presentation==="joystick"?0:u[1].presentation==="imu"?1:2}return t=l(e,-1),n=s[t]=r[t](e),{c(){n.c(),o=lt()},m(u,a){s[t].m(u,a),R(u,o,a),i=!0},p(u,a){let $=t;t=l(u,a),t===$?s[t].p(u,a):(Q(),W(s[$],1,1,()=>{s[$]=null}),tt(),n=s[t],n?n.p(u,a):(n=s[t]=r[t](u),n.c()),B(n,1),n.m(o.parentNode,o))},i(u){i||(B(n),i=!0)},o(u){W(n),i=!1},d(u){u&&N(o),s[t].d(u)}}}function wn(e){let t,n;return{c(){t=p("pre"),n=v(e[2]),k(t,"class","topic-payload")},m(o,i){R(o,t,i),c(t,n)},p(o,i){i&4&&z(n,o[2])},i:q,o:q,d(o){o&&N(t)}}}function vn(e){let t,n;return t=new Ce({props:{data:e[0].last}}),{c(){dt(t.$$.fragment)},m(o,i){ut(t,o,i),n=!0},p(o,i){let r={};i&1&&(r.data=o[0].last),t.$set(r)},i(o){n||(B(t.$$.fragment,o),n=!0)},o(o){W(t.$$.fragment,o),n=!1},d(o){at(t,o)}}}function kn(e){let t,n;return t=new Se({props:{record:e[0]}}),{c(){dt(t.$$.fragment)},m(o,i){ut(t,o,i),n=!0},p(o,i){let r={};i&1&&(r.record=o[0]),t.$set(r)},i(o){n||(B(t.$$.fragment,o),n=!0)},o(o){W(t.$$.fragment,o),n=!1},d(o){at(t,o)}}}function Fn(e){let t,n,o,i,r,s,l,u,a,$,x,b=e[0]?.paused&&Oe(e),F=e[0]?.error&&Me(e),w=[xn,$n],D=[];function M(d,_){return d[0]?0:1}return a=M(e,-1),$=D[a]=w[a](e),{c(){t=p("div"),n=p("div"),o=p("span"),i=v(e[3]),s=j(),b&&b.c(),l=j(),F&&F.c(),u=j(),$.c(),k(o,"class",r=`state ${e[3]}`),k(n,"class","topic-state"),k(t,"class","topic-widget")},m(d,_){R(d,t,_),c(t,n),c(n,o),c(o,i),c(n,s),b&&b.m(n,null),c(n,l),F&&F.m(n,null),c(t,u),D[a].m(t,null),x=!0},p(d,[_]){(!x||_&8)&&z(i,d[3]),(!x||_&8&&r!==(r=`state ${d[3]}`))&&k(o,"class",r),d[0]?.paused?b||(b=Oe(d),b.c(),b.m(n,l)):b&&(b.d(1),b=null),d[0]?.error?F?F.p(d,_):(F=Me(d),F.c(),F.m(n,null)):F&&(F.d(1),F=null);let m=a;a=M(d,_),a===m?D[a].p(d,_):(Q(),W(D[m],1,1,()=>{D[m]=null}),tt(),$=D[a],$?$.p(d,_):($=D[a]=w[a](d),$.c()),B($,1),$.m(t,null))},i(d){x||(B($),x=!0)},o(d){W($),x=!1},d(d){d&&N(t),b&&b.d(),F&&F.d(),D[a].d()}}}var Te=1200;function U(e,t=2){return typeof e=="number"&&Number.isFinite(e)?e.toFixed(t):"--"}function En(e){if(!e)return"Awaiting frame\u2026";let t=e.width??e.info?.width,n=e.height??e.info?.height,o=e.encoding??e.info?.encoding??"unknown",i=e.step??e.info?.step;return`Resolution: ${t} \xD7 ${n}
Encoding: ${o}
Step: ${i??"--"}`}function Sn(e){if(!e)return"Awaiting occupancy grid\u2026";let t=e.info?.width??e.width,n=e.info?.height??e.height,o=e.info?.resolution;return`Size: ${t} \xD7 ${n}
Resolution: ${U(o,3)} m/px`}function Cn(e){return e?`Waypoints: ${(e.poses??[]).length}`:"Awaiting path\u2026"}function On(e){if(!e)return"Awaiting pose\u2026";let t=e.pose?.pose?.position??e.pose?.position??e.position??{},n=e.pose?.pose?.orientation??e.pose?.orientation??e.orientation??{};return`Position: (${U(t.x)}, ${U(t.y)}, ${U(t.z)})
Orientation: (${U(n.x)}, ${U(n.y)}, ${U(n.z)}, ${U(n.w)})`}function Mn(e){if(!e)return"Awaiting twist\u2026";let t=e.twist?.twist?.linear??e.twist?.linear??e.linear??{},n=e.twist?.twist?.angular??e.twist?.angular??e.angular??{};return`Linear: (${U(t.x)}, ${U(t.y)}, ${U(t.z)})
Angular: (${U(n.x)}, ${U(n.y)}, ${U(n.z)})`}function Tn(e){return e==null?"Awaiting message\u2026":typeof e=="string"?e:typeof e.data=="string"?e.data:JSON.stringify(e,null,2)}function An(e){if(e==null)return"Awaiting data\u2026";let t=typeof e=="string"?e:JSON.stringify(e,null,2);return t.length>Te?`${t.slice(0,Te)}\u2026`:t}function jn(e,t,n){let o,i,{record:r}=t,{topic:s}=t;return e.$$set=l=>{"record"in l&&n(0,r=l.record),"topic"in l&&n(1,s=l.topic)},e.$$.update=()=>{e.$$.dirty&1&&n(3,o=r?r.state:"idle"),e.$$.dirty&3&&n(2,i=(()=>{if(!r)return null;let l=s.presentation||"";return l==="image"||l==="depth"?En(r.last):l==="map"?Sn(r.last):l==="path"?Cn(r.last):l==="pose"?On(r.last):l==="vector"?Mn(r.last):l==="status"||l==="text"||l==="log"?Tn(r.last):An(r.last)})())},[r,s,i,o]}var oe=class extends H{constructor(t){super(),et(this,t,jn,Fn,K,{record:0,topic:1})}},Ae=oe;function je(e,t,n){let o=e.slice();return o[14]=t[n],o}function De(e,t,n){let o=e.slice();return o[17]=t[n],o}function Ne(e,t,n){let o=e.slice();return o[17]=t[n],o}function Le(e){let t,n=e[0].description+"",o;return{c(){t=p("p"),o=v(n)},m(i,r){R(i,t,r),c(t,o)},p(i,r){r&1&&n!==(n=i[0].description+"")&&z(o,n)},d(i){i&&N(t)}}}function Pe(e){let t,n=e[17]+"",o,i,r;function s(){return e[8](e[17])}return{c(){t=p("button"),o=v(n),k(t,"type","button")},m(l,u){R(l,t,u),c(t,o),i||(r=it(t,"click",s),i=!0)},p(l,u){e=l,u&1&&n!==(n=e[17]+"")&&z(o,n)},d(l){l&&N(t),i=!1,r()}}}function Re(e){let t,n=e[17]+"",o,i,r;function s(){return e[9](e[17])}return{c(){t=p("button"),o=v(n),k(t,"type","button")},m(l,u){R(l,t,u),c(t,o),i||(r=it(t,"click",s),i=!0)},p(l,u){e=l,u&1&&n!==(n=e[17]+"")&&z(o,n)},d(l){l&&N(t),i=!1,r()}}}function ze(e){let t=e[5](e[14]),n,o,i=Ie(e);return{c(){i.c(),n=lt()},m(r,s){i.m(r,s),R(r,n,s),o=!0},p(r,s){s&1&&K(t,t=r[5](r[14]))?(Q(),W(i,1,1,q),tt(),i=Ie(r),i.c(),B(i,1),i.m(n.parentNode,n)):i.p(r,s)},i(r){o||(B(i),o=!0)},o(r){W(i),o=!1},d(r){r&&N(n),i.d(r)}}}function Dn(e){let t,n,o,i;function r(){return e[12](e[14])}return{c(){t=p("div"),n=p("button"),n.textContent="Connect",k(n,"type","button"),k(t,"class","topic-actions")},m(s,l){R(s,t,l),c(t,n),o||(i=it(n,"click",r),o=!0)},p(s,l){e=s},d(s){s&&N(t),o=!1,i()}}}function Nn(e){let t,n,o,i,r=e[6](e[14]).paused?"Resume":"Pause",s,l,u;function a(){return e[10](e[14])}function $(){return e[11](e[14])}return{c(){t=p("div"),n=p("button"),n.textContent="Disconnect",o=j(),i=p("button"),s=v(r),k(n,"type","button"),k(i,"type","button"),k(t,"class","topic-actions")},m(x,b){R(x,t,b),c(t,n),c(t,o),c(t,i),c(i,s),l||(u=[it(n,"click",a),it(i,"click",$)],l=!0)},p(x,b){e=x,b&1&&r!==(r=e[6](e[14]).paused?"Resume":"Pause")&&z(s,r)},d(x){x&&N(t),l=!1,V(u)}}}function Ie(e){let t,n,o,i,r=(e[14].name||e[14].topic)+"",s,l,u,a=e[14].type+"",$,x,b,F,w,D,M;function d(g,L){return L&1&&(b=null),b==null&&(b=!!g[6](g[14])),b?Nn:Dn}let _=d(e,-1),m=_(e);return w=new Ae({props:{record:e[6](e[14]),topic:e[14]}}),{c(){t=p("article"),n=p("div"),o=p("div"),i=p("h4"),s=v(r),l=j(),u=p("small"),$=v(a),x=j(),m.c(),F=j(),dt(w.$$.fragment),D=j(),k(n,"class","topic-header"),k(t,"class","topic-card")},m(g,L){R(g,t,L),c(t,n),c(n,o),c(o,i),c(i,s),c(o,l),c(o,u),c(u,$),c(n,x),m.m(n,null),c(t,F),ut(w,t,null),c(t,D),M=!0},p(g,L){(!M||L&1)&&r!==(r=(g[14].name||g[14].topic)+"")&&z(s,r),(!M||L&1)&&a!==(a=g[14].type+"")&&z($,a),_===(_=d(g,L))&&m?m.p(g,L):(m.d(1),m=_(g),m&&(m.c(),m.m(n,null)));let I={};L&1&&(I.record=g[6](g[14])),L&1&&(I.topic=g[14]),w.$set(I)},i(g){M||(B(w.$$.fragment,g),M=!0)},o(g){W(w.$$.fragment,g),M=!1},d(g){g&&N(t),m.d(),at(w)}}}function qe(e,t){let n,o,i,r=t[14]&&ze(t);return{key:e,first:null,c(){n=lt(),r&&r.c(),o=lt(),this.first=n},m(s,l){R(s,n,l),r&&r.m(s,l),R(s,o,l),i=!0},p(s,l){t=s,t[14]?r?(r.p(t,l),l&1&&B(r,1)):(r=ze(t),r.c(),B(r,1),r.m(o.parentNode,o)):r&&(Q(),W(r,1,1,()=>{r=null}),tt())},i(s){i||(B(r),i=!0)},o(s){W(r),i=!1},d(s){s&&(N(n),N(o)),r&&r.d(s)}}}function Ln(e){let t,n,o,i=(e[0].display_name||e[0].name)+"",r,s,l,u,a,$,x,b,F,w,D,M,d,_,m,g=[],L=new Map,I,C,S=e[0].description&&Le(e),h=Y(e[0].commands?.mod??[]),f=[];for(let y=0;y<h.length;y+=1)f[y]=Pe(Ne(e,h,y));let A=Y(e[0].commands?.system??[]),O=[];for(let y=0;y<A.length;y+=1)O[y]=Re(De(e,A,y));let T=Y(e[0].topics),G=y=>y[14].name||y[14].topic;for(let y=0;y<T.length;y+=1){let P=je(e,T,y),E=G(P);L.set(E,g[y]=qe(E,P))}return{c(){t=p("section"),n=p("header"),o=p("h2"),r=v(i),s=j(),S&&S.c(),l=j(),u=p("div"),a=p("div"),$=p("h3"),$.textContent="Module Commands",x=j(),b=p("div");for(let y=0;y<f.length;y+=1)f[y].c();F=j(),w=p("div"),D=p("h3"),D.textContent="System Commands",M=j(),d=p("div");for(let y=0;y<O.length;y+=1)O[y].c();_=j(),m=p("div");for(let y=0;y<g.length;y+=1)g[y].c();k(b,"class","button-row"),k(a,"class","command-set"),k(d,"class","button-row"),k(w,"class","command-set"),k(u,"class","command-groups"),k(n,"class","module-header"),k(m,"class","topics-grid"),k(t,"class","module-section"),k(t,"id",I=`module-${e[0].name}`)},m(y,P){R(y,t,P),c(t,n),c(n,o),c(o,r),c(n,s),S&&S.m(n,null),c(n,l),c(n,u),c(u,a),c(a,$),c(a,x),c(a,b);for(let E=0;E<f.length;E+=1)f[E]&&f[E].m(b,null);c(u,F),c(u,w),c(w,D),c(w,M),c(w,d);for(let E=0;E<O.length;E+=1)O[E]&&O[E].m(d,null);c(t,_),c(t,m);for(let E=0;E<g.length;E+=1)g[E]&&g[E].m(m,null);C=!0},p(y,[P]){if((!C||P&1)&&i!==(i=(y[0].display_name||y[0].name)+"")&&z(r,i),y[0].description?S?S.p(y,P):(S=Le(y),S.c(),S.m(n,l)):S&&(S.d(1),S=null),P&3){h=Y(y[0].commands?.mod??[]);let E;for(E=0;E<h.length;E+=1){let ot=Ne(y,h,E);f[E]?f[E].p(ot,P):(f[E]=Pe(ot),f[E].c(),f[E].m(b,null))}for(;E<f.length;E+=1)f[E].d(1);f.length=h.length}if(P&3){A=Y(y[0].commands?.system??[]);let E;for(E=0;E<A.length;E+=1){let ot=De(y,A,E);O[E]?O[E].p(ot,P):(O[E]=Re(ot),O[E].c(),O[E].m(d,null))}for(;E<O.length;E+=1)O[E].d(1);O.length=A.length}P&125&&(T=Y(y[0].topics),Q(),g=qt(g,P,G,1,y,T,L,m,It,qe,null,je),tt()),(!C||P&1&&I!==(I=`module-${y[0].name}`))&&k(t,"id",I)},i(y){if(!C){for(let P=0;P<T.length;P+=1)B(g[P]);C=!0}},o(y){for(let P=0;P<g.length;P+=1)W(g[P]);C=!1},d(y){y&&N(t),S&&S.d(),bt(f,y),bt(O,y);for(let P=0;P<g.length;P+=1)g[P].d()}}}function Pn(e,t,n){let{module:o}=t,{activeTopics:i}=t,r=Zt();function s(d,_){r("runCommand",{scope:d,command:_})}function l(d){r("startTopic",{module:o.name,topic:d})}function u(d){r("stopTopic",{module:o.name,topic:d})}function a(d,_){r("pauseTopic",{module:o.name,topic:d,paused:_})}function $(d){return`${o.name}:${d.name||d.topic}`}function x(d){return i.get($(d))}let b=d=>s("mod",d),F=d=>s("sys",d),w=d=>u(d),D=d=>a(d,!x(d).paused),M=d=>l(d);return e.$$set=d=>{"module"in d&&n(0,o=d.module),"activeTopics"in d&&n(7,i=d.activeTopics)},[o,s,l,u,a,$,x,i,b,F,w,D,M]}var re=class extends H{constructor(t){super(),et(this,t,Pn,Ln,K,{module:0,activeTopics:7})}},Be=re;var{Map:Rn}=yt;function We(e,t,n){let o=e.slice();return o[22]=t[n],o[24]=n,o}function Ge(e,t,n){let o=e.slice();return o[25]=t[n],o}function zn(e){let t,n=[],o=new Rn,i,r=Y(e[0]),s=l=>l[25].name;for(let l=0;l<r.length;l+=1){let u=Ge(e,r,l),a=s(u);o.set(a,n[l]=Xe(a,u))}return{c(){t=p("div");for(let l=0;l<n.length;l+=1)n[l].c();k(t,"class","pilot-layout")},m(l,u){R(l,t,u);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(t,null);i=!0},p(l,u){u&977&&(r=Y(l[0]),Q(),n=qt(n,u,s,1,l,r,o,t,It,Xe,null,Ge),tt())},i(l){if(!i){for(let u=0;u<r.length;u+=1)B(n[u]);i=!0}},o(l){for(let u=0;u<n.length;u+=1)W(n[u]);i=!1},d(l){l&&N(t);for(let u=0;u<n.length;u+=1)n[u].d()}}}function In(e){let t,n;return{c(){t=p("div"),n=v(e[2]),k(t,"class","error")},m(o,i){R(o,t,i),c(t,n)},p(o,i){i&4&&z(n,o[2])},i:q,o:q,d(o){o&&N(t)}}}function qn(e){let t;return{c(){t=p("div"),t.textContent="Loading pilot modules\u2026",k(t,"class","loading")},m(n,o){R(n,t,o)},p:q,i:q,o:q,d(n){n&&N(t)}}}function Xe(e,t){let n,o,i;function r(...s){return t[10](t[25],...s)}return o=new Be({props:{id:`module-${t[25].name}`,module:t[25],activeTopics:t[4]}}),o.$on("runCommand",r),o.$on("startTopic",t[7]),o.$on("stopTopic",t[8]),o.$on("pauseTopic",t[9]),{key:e,first:null,c(){n=lt(),dt(o.$$.fragment),this.first=n},m(s,l){R(s,n,l),ut(o,s,l),i=!0},p(s,l){t=s;let u={};l&1&&(u.id=`module-${t[25].name}`),l&1&&(u.module=t[25]),l&16&&(u.activeTopics=t[4]),o.$set(u)},i(s){i||(B(o.$$.fragment,s),i=!0)},o(s){W(o.$$.fragment,s),i=!1},d(s){s&&N(n),at(o,s)}}}function Je(e){let t,n,o,i,r=Y(e[3]),s=[];for(let l=0;l<r.length;l+=1)s[l]=Ye(We(e,r,l));return{c(){t=p("section"),n=p("h2"),n.textContent="Command Log",o=j(),i=p("ul");for(let l=0;l<s.length;l+=1)s[l].c();k(t,"class","command-log"),k(t,"id","command-log")},m(l,u){R(l,t,u),c(t,n),c(t,o),c(t,i);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(i,null)},p(l,u){if(u&8){r=Y(l[3]);let a;for(a=0;a<r.length;a+=1){let $=We(l,r,a);s[a]?s[a].p($,u):(s[a]=Ye($),s[a].c(),s[a].m(i,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=r.length}},d(l){l&&N(t),bt(s,l)}}}function Bn(e){let t,n=JSON.stringify(e[22].result)+"",o;return{c(){t=p("span"),o=v(n),k(t,"class","detail")},m(i,r){R(i,t,r),c(t,o)},p(i,r){r&8&&n!==(n=JSON.stringify(i[22].result)+"")&&z(o,n)},d(i){i&&N(t)}}}function Wn(e){let t,n=e[22].error+"",o;return{c(){t=p("span"),o=v(n),k(t,"class","detail")},m(i,r){R(i,t,r),c(t,o)},p(i,r){r&8&&n!==(n=i[22].error+"")&&z(o,n)},d(i){i&&N(t)}}}function Ye(e){let t,n,o=e[22].timestamp+"",i,r,s,l=e[22].module+"",u,a,$,x=e[22].scope+"",b,F,w,D=e[22].command+"",M,d,_,m;function g(C,S){if(C[22].status==="error")return Wn;if(C[22].result)return Bn}let L=g(e,-1),I=L&&L(e);return{c(){t=p("li"),n=p("span"),i=v(o),r=j(),s=p("span"),u=v(l),a=j(),$=p("span"),b=v(x),F=j(),w=p("span"),M=v(D),d=j(),I&&I.c(),_=j(),k(n,"class","timestamp"),k(s,"class","module"),k($,"class","scope"),k(w,"class","command"),k(t,"class",m=e[22].status)},m(C,S){R(C,t,S),c(t,n),c(n,i),c(t,r),c(t,s),c(s,u),c(t,a),c(t,$),c($,b),c(t,F),c(t,w),c(w,M),c(t,d),I&&I.m(t,null),c(t,_)},p(C,S){S&8&&o!==(o=C[22].timestamp+"")&&z(i,o),S&8&&l!==(l=C[22].module+"")&&z(u,l),S&8&&x!==(x=C[22].scope+"")&&z(b,x),S&8&&D!==(D=C[22].command+"")&&z(M,D),L===(L=g(C,S))&&I?I.p(C,S):(I&&I.d(1),I=L&&L(C),I&&(I.c(),I.m(t,_))),S&8&&m!==(m=C[22].status)&&k(t,"class",m)},d(C){C&&N(t),I&&I.d()}}}function Gn(e){let t,n,o,i,r,s,l,u,a,$,x,b=e[0].length+"",F,w,D=[qn,In,zn],M=[];function d(m,g){return m[1]?0:m[2]?1:2}t=d(e,-1),n=M[t]=D[t](e);let _=e[3].length&&Je(e);return{c(){n.c(),o=j(),_&&_.c(),i=j(),r=p("footer"),s=p("div"),l=v("Active sockets: "),u=v(e[5]),a=j(),$=p("div"),x=v("Total modules: "),F=v(b),k(r,"class","status-bar")},m(m,g){M[t].m(m,g),R(m,o,g),_&&_.m(m,g),R(m,i,g),R(m,r,g),c(r,s),c(s,l),c(s,u),c(r,a),c(r,$),c($,x),c($,F),w=!0},p(m,[g]){let L=t;t=d(m,g),t===L?M[t].p(m,g):(Q(),W(M[L],1,1,()=>{M[L]=null}),tt(),n=M[t],n?n.p(m,g):(n=M[t]=D[t](m),n.c()),B(n,1),n.m(o.parentNode,o)),m[3].length?_?_.p(m,g):(_=Je(m),_.c(),_.m(i.parentNode,i)):_&&(_.d(1),_=null),(!w||g&32)&&z(u,m[5]),(!w||g&1)&&b!==(b=m[0].length+"")&&z(F,b)},i(m){w||(B(n),w=!0)},o(m){W(n),w=!1},d(m){m&&(N(o),N(i),N(r)),M[t].d(m),_&&_.d(m)}}}var Xn=40;function Bt(e,t){return`${e}:${t.name||t.topic||t}`}function Jn(e){try{e.socket?.close()}catch(t){console.warn("Failed to close socket",t)}}function Yn(e,t,n){let o=[],i=!0,r="",s=[],l=new Map,u=0;function a(){if(typeof window>"u")return;let h=o.map((f,A)=>({id:`module-${f.name}`,label:f.display_name||f.name,index:A}));window.dispatchEvent(new CustomEvent("pilot-sections",{detail:h}))}function $(h){n(3,s=[{...h,timestamp:new Date().toISOString()},...s].slice(0,Xn))}function x(h,f){let A=new Map(l);A.set(h,f),n(4,l=A)}function b(h){let f=new Map(l);f.delete(h),n(4,l=f)}async function F(){n(1,i=!0),n(2,r="");try{let h=await fetch("/api/modules");if(!h.ok)throw new Error(`Failed to load modules (${h.status})`);let f=await h.json();n(0,o=f.modules??[]),a()}catch(h){n(2,r=h.message??String(h))}finally{n(1,i=!1)}}$t(()=>{F()});async function w(h,f,A){try{$({module:h,scope:f,command:A,status:"running"});let O=await fetch(`/api/modules/${h}/commands`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scope:f,command:A})});if(!O.ok){let G=await O.json().catch(()=>({}));throw new Error(G.detail||`Command failed (${O.status})`)}let T=await O.json();$({module:h,scope:f,command:A,status:"ok",result:T.result})}catch(O){$({module:h,scope:f,command:A,status:"error",error:O.message??String(O)})}}function D(h,f){return l.get(Bt(h,f))}function M(h,f,A){let O=Bt(h,f),T=l.get(O);if(!T)return;let G=A(T)||T;x(O,G)}async function d(h,f){let A=Bt(h,f);if(l.has(A))return;let O={topic:f.topic||f.name,access:f.access||"ro",module:h,qos:f.qos??void 0};try{let T=await fetch("/api/topics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!T.ok){let E=await T.json().catch(()=>({}));throw new Error(E.detail||`Unable to subscribe (${T.status})`)}let y=(await T.json()).session,P={module:h,topic:f,session:y,state:"connecting",last:null,messages:[],paused:!!y.paused,socket:null,error:null,send(E){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(E))}};x(A,P),g(A,P)}catch(T){$({module:h,scope:"topic",command:O.topic,status:"error",error:T.message??String(T)})}}async function _(h,f){let A=Bt(h,f),O=l.get(A);if(O){Jn(O);try{await fetch(`/api/topics/${O.session.id}`,{method:"DELETE"})}catch(T){console.warn("Failed to drop topic",T)}b(A)}}async function m(h,f,A){let O=D(h,f);if(O)try{let T=await fetch(`/api/topics/${O.session.id}/pause`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paused:A})});if(!T.ok){let y=await T.json().catch(()=>({}));throw new Error(y.detail||`Failed to update pause (${T.status})`)}let G=await T.json();M(h,f,y=>({...y,paused:G.session.paused}))}catch(T){$({module:h,scope:"topic",command:`${f.topic||f.name}:pause`,status:"error",error:T.message??String(T)})}}function g(h,f){let O=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/ws/topics/${f.session.id}`;try{let T=new WebSocket(O);f.socket=T,n(5,u+=1),f.state="connecting",x(h,f),T.addEventListener("open",()=>{f.state="connected",f.error=null,x(h,f)}),T.addEventListener("close",()=>{f.state="closed",x(h,f),n(5,u=Math.max(0,u-1))}),T.addEventListener("error",()=>{f.error="WebSocket error",x(h,f)}),T.addEventListener("message",G=>{try{let y=JSON.parse(G.data);f.last=y.data??y,f.messages=[f.last,...f.messages].slice(0,50),x(h,f)}catch(y){console.warn("Failed to parse topic payload",y)}})}catch(T){f.error=T.message??String(T),f.state="error",x(h,f)}}function L(h){let{module:f,topic:A}=h.detail;d(f,A)}function I(h){let{module:f,topic:A}=h.detail;_(f,A)}function C(h){let{module:f,topic:A,paused:O}=h.detail;m(f,A,O)}return[o,i,r,s,l,u,w,L,I,C,(h,{detail:f})=>w(h.name,f.scope,f.command)]}var ie=class extends H{constructor(t){super(),et(this,t,Yn,Gn,K,{})}},Ue=ie;var Ve=document.getElementById("pilot-app");Ve&&new Ue({target:Ve});
